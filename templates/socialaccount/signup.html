{% load i18n allauth account %}

<!DOCTYPE html>
<html>
<head>
    <title>{% trans "Sign Up" %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* Add a fallback for the custom font */
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-playfair {
            font-family: 'Playfair Display', serif;
        }
        /* Style for sr-only to hide labels accessibly */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body class="bg-[#0d0d0d]">

<div class="min-h-screen flex items-center justify-center bg-[#0d0d0d] px-4">
  <div class="w-full max-w-md bg-[#111111]/80 backdrop-blur-md p-8 rounded-2xl shadow-2xl border border-[#1e1e1e]">
    
    <!-- Title -->
    <h1 class="font-playfair text-3xl text-gray-100 text-center mb-2">
      {% trans "Final Step" %}
    </h1>
    
    <!-- Subtitle -->
    <p class="text-center text-gray-400 text-sm mb-6">
        {% blocktrans with provider_name=account.get_provider.name site_name=site.name %}You are about to use your {{ provider_name }} account to sign up for {{ site_name }}. Please complete the form below.{% endblocktrans %}
    </p>

    <!-- Social Signup Form -->
    {% url 'socialaccount_signup' as action_url %}
    <form method="post" action="{{ action_url }}" class="space-y-4" id="social_signup_form">
      {% csrf_token %}

      <!-- Allauth renders form fields here -->
      {% element fields form=form unlabeled=True %}
      {% endelement %}

      {{ redirect_field }}

      <!-- Error Messages -->
      {% if form.non_field_errors %}
          <div class="text-red-400 text-sm mt-2">
              {% for error in form.non_field_errors %}
                  <p>{{ error }}</p>
              {% endfor %}
          </div>
      {% endif %}

      <!-- Submit Button -->
      <button type="submit"
        class="w-full bg-gray-100 text-[#111111] font-semibold py-3 rounded-lg hover:bg-gray-300 transition mt-4">
        {% trans "Complete Sign Up" %}
      </button>
    </form>

  </div>
</div>

<script>
    // This script applies the dark theme styles to the form fields generated by Django allauth.
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('social_signup_form');
        if (!form) return;

        const baseClasses = 'w-full bg-[#1a1a1a] text-gray-100 placeholder-gray-500 rounded-lg px-4 py-3 text-sm border border-[#2a2a2a] focus:outline-none focus:border-gray-400 transition';
        
        // Style all input types except hidden and checkbox
        const inputs = form.querySelectorAll('input:not([type="hidden"]):not([type="checkbox"])');
        inputs.forEach(input => {
            input.classList.add(...baseClasses.split(' '));
            const label = form.querySelector(`label[for="${input.id}"]`);
            if (label && !input.placeholder) {
                input.placeholder = label.textContent.trim();
                label.classList.add('sr-only'); // Hide the label as we now use a placeholder
            }
        });
        
        // Style select dropdowns if any
        const selects = form.querySelectorAll('select');
        selects.forEach(select => {
            select.classList.add(...baseClasses.split(' '));
        });

        // Style error lists if any
        const errorLists = form.querySelectorAll('.errorlist');
        errorLists.forEach(ul => {
            ul.classList.add('text-red-400', 'text-sm', 'list-none', 'p-0', 'm-0', 'mt-1');
            ul.querySelectorAll('li').forEach(li => {
                 li.classList.add('p-0', 'm-0');
            });
        });

    });
</script>

</body>
</html>
